<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="referrer" content="same-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="feed" href="/feeds/all.atom.xml" title="Articles">

<link rel="canonical" href="http://betatim.github.io/posts/genome-hackers/">
<meta property="og:url" content="http://betatim.github.io/posts/genome-hackers/" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Genome Assembly for Hackers" />

    <title>Genome Assembly for Hackers - Tim Head's blog</title>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
    <link href="/theme/simplez.css" rel="stylesheet">
    <link href="/theme/pygments/default.css" rel="stylesheet">

    <script>
      // Only load GA if DNT is not set
      if (navigator.doNotTrack != "1" && // Most Firefox & Chrome
          window.doNotTrack != "1" && // IE & Safari
          navigator.msDoNotTrack != "1" // Old IE
      ) {
        console.log("Loading Google Analytics, since Do Not Track is off");
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-49540142-1', 'betatim.github.io', {'storage': 'none'});
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
      }
    </script>

    <script>
    window.MathJax = {
      tex: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        autoload: {
          color: [],
          colorV2: ['color']
        },
        packages: {'[+]': ['noerrors']}
      },
      chtml: {
        displayAlign: 'left'    // Change this to 'center' to center equations.
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      },
      loader: {
        load: ['[tex]/noerrors']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/tex-mml-chtml.js"></script>


  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center pb-5">
        <div class="col-md-8 px-0">
          <nav class="navbar navbar-expand-lg navbar-light bg-white">
            <a class="navbar-brand" href="http://betatim.github.io/">Tim<b>Head</b></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">

                  <li class="nav-item ">
                    <a class="nav-link" href="/pages/about-me">
                      About Me
                     </a>
                  </li>
              </ul>
            </div>
          </nav>
        </div>
      </div>

      <div class="row justify-content-center pb-5">
        <div class="col-md-8">
<article>
  <header class="title">
    <h1>
      Genome Assembly for Hackers
    </h1>
    <div class="when small mb-3">09 June 2016</div>
  </header>
  <div class="entry-content">
    <div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This post collects code snippets I created while learning about genome assembly.
I understand complicated things through code. I build simulations or little
tools and they help me immensely to understand how something works. Probably
because it uses vocabulary I am familiar with (python!) instead of domain
specific jargon.</p>
<p>For another great example of "understanding X through code" check out <a href="https://twitter.com/jakevdp">Jake VanderPlas'</a> talk <a href="https://speakerdeck.com/jakevdp/statistics-for-hackers">Statistics for hackers</a> (<a href="https://www.youtube.com/watch?v=-7I7MWTX0gA">video</a>).</p>
<p>This post covers the basic basics of "genome assembly". Starting with a genome,
creating "reads" from it, breaking these reads up into "kmers", and then
doing the actual assembly. There are a lot of subtleties that I gloss over,
ignored details and ouright shortcuts (hashtag-physics-style). Please biology
friends, don't hate me :)</p>
<p>I assume you have done some reading about this topic and came here to see it
translated into code. I link to various wikipedia articles through out, but
otherwise will not try and explain the biology reasoning behind all this (not just
because I don't know it myself ...).</p>
<p>Let's start with generating a random "genome".</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Genome">The Genome<a class="anchor-link" href="#The-Genome">&#182;</a></h2><p>We will use a fairly short genome made up totally at random. In reality
genomes have millions or billions of base pairs and contain structure.
Welcome to the world of <a href="https://en.wikipedia.org/wiki/Spherical_cow">"spherical cows in a vacuum"</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">genome</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s2">&quot;AGCT&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this is a great genome, trust me</span>
<span class="n">genome</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&#39;ACATCAATCCAGGCCGGATATAACTAAAGGACTTCTACCTGCATTTTCAGATCGCCTATTCAGACACGTACTGTGGTTTAAGTGACCCTTAAACAATATATACCTACTCAGTAGCGAATCGCTCGCAGTTAGTACTTCTAGCGCACGCACGGCCTAAGGAGCGACACGGTTTACTCTGGATCAACTCTCCGTCGGTATTCGTCACACCATATCATCGTCTCGTCCAGAATTGTATGCCGATCACTGACCGTCTAATGGACGGCTTGCAATCGATTTAATTCGTGGGGAGGATAATCAAGTCGCACCGACGTGTGTTGTATACGTAGATCATCCCGTAAACAGTGTGTGAGACAAGGTTGTAAGATAGACTGGGTCGAACCTCGAAAAGCGGACTCCGTACCCACACATGCTAGTAGGCTTCGTACAGGCGAGACAACACCGCTACAACCCTGAAAATTCGGTATGGATGAGCTGTCAAATCAGCCCAGCCGTGTATAGGAGATGTTCAGATACAGAGAATTTCGTTAAAGGGCCTCCTGAAGATGTACCTCCCGGACAATCTGAAGTGATGTCCTCCTGGAAGCAGGGTGGGTATGCCTGATTTCATTACTTAAACCCGTCGAGGTGTTACGCCCACGAAGATTTTAGGCGCTTATACTAGCAACGGAATTTTATAACTTCCCACGAATTCAGCCCGCTCGATGGCGTGCGGTTCTTTCTCATTACTGGAGTTCGCGGTATACTGGCGGCTGGTCGGCGACGTAGGCGCAAGACGAGTTGAAGATGGCGTGCTATCTTGGGGCTGGGGGTAACGATTGGTACCCCGGGGAATCTAGTCATCATAGCCGTTCATTCCAGCCCAAACCTTTGGGGCGTGGTCTGCCTTAGTGGGCTCATCTAGACGCGTGGGGGCTTATTCCGAGTCACGTCTTAAGGTTGATACGGGAAATTCGCTGGGAGCCTCGTCGGGACGCATAACATCAGGCTGTCGCCTCTCCGT&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reading">Reading<a class="anchor-link" href="#Reading">&#182;</a></h2><p>To get the genome out of a cell you need to read it. This is called <a href="https://en.wikipedia.org/wiki/Sequencing">sequencing</a>. While there are many methods to do
this in an actual lab, in practice they all create "reads". These are short sections
of the genome that cover a random part of it. To start with let's assume we can
generate these reads without making any mistakes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">perfect_reads</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">n_reads</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create perfect reads from `genome`&quot;&quot;&quot;</span>
    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">genome</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_reads</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_reads</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_reads</span><span class="p">):</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">starts</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">genome</span><span class="p">[</span><span class="n">low</span><span class="p">:</span><span class="n">low</span> <span class="o">+</span> <span class="n">length</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">perfect_reads</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[&#39;GAAGATGTACCTCCCGGACAATCTGAAG&#39;,
 &#39;GCAGTTAGTACTTCTAGCGCACGCACG&#39;,
 &#39;GGGCTGGGGGTAACGATTGGTACCCCGG&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Reads can vary in size and come without information about where
in the genome they took place. You can end up with duplicate reads
of parts of reads overlapping. This is a good thing. These overlaps
is what will allow us to piece everything back together. Read more
about <a href="https://en.wikipedia.org/wiki/Shotgun_sequencing">Shotgun sequencing</a></p>
<p><em>NB:</em> Today most real world sequencing is done using <a href="https://en.wikipedia.org/wiki/Shotgun_sequencing#Whole_genome_shotgun_sequencing">"double barrel"
shotguns</a>. The key realisation is that you can create reads from both ends of
a fragment of the genome. This way you gain some information about the
direction of the reads relative to each other and how far they are apart.</p>
<p>Next each read is turned into a <a href="https://en.wikipedia.org/wiki/K-mer"><code>k-mer</code></a>.
These are what is used during the actual assembly. <code>k-mer</code>s are the substrings of
length <code>k</code> that you can generate from a string.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">kmers</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate `k`-mers from a `read`&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">read</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">read</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">k</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_perfect_kmers</span><span class="p">(</span><span class="n">genome</span><span class="p">):</span>
    <span class="n">kmers_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="n">perfect_reads</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">n_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kmer</span> <span class="ow">in</span> <span class="n">kmers</span><span class="p">(</span><span class="n">read</span><span class="p">):</span>
            <span class="n">kmers_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kmer</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">kmers_</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kmers_</span> <span class="o">=</span> <span class="n">get_perfect_kmers</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
<span class="c1"># lots of kmers, but not that many are unique</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kmers_</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kmers_</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>19968 990
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With perfect reads from our random genome you end up with a
large number of <code>k-mers</code> (of length ten) but most of them
are duplicates. The roughly 20000 <code>k-mers</code> we created only
contain about 1000 unique <code>k-mers</code>.</p>
<h2 id="Flipping-reads">Flipping reads<a class="anchor-link" href="#Flipping-reads">&#182;</a></h2><p>In reality the sequencing process is not perfect and will
make mistakes. The simplest way to illustrate this is to
randomly flip a base in a read. Even fairly low error rates
of 1% per base have a large effect on the number of unique <code>k-mers</code>
we find.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">flip</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Flip a base to one of the other bases with probability `p`&quot;&quot;&quot;</span>
    <span class="n">bases</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">read</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s2">&quot;AGCT&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reads_with_errors</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">n_reads</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate reads where bases might be flipped.&quot;&quot;&quot;</span>
    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">genome</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_reads</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_reads</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_reads</span><span class="p">):</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">starts</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">flip</span><span class="p">(</span><span class="n">genome</span><span class="p">[</span><span class="n">low</span><span class="p">:</span><span class="n">low</span> <span class="o">+</span> <span class="n">length</span><span class="p">[</span><span class="n">n</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_kmers</span><span class="p">(</span><span class="n">genome</span><span class="p">):</span>
    <span class="n">kmers_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">read</span> <span class="ow">in</span> <span class="n">reads_with_errors</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">n_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kmer</span> <span class="ow">in</span> <span class="n">kmers</span><span class="p">(</span><span class="n">read</span><span class="p">):</span>
            <span class="n">kmers_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kmer</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">kmers_</span>

<span class="n">kmers_</span> <span class="o">=</span> <span class="n">get_kmers</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
<span class="c1"># roughly same number of kmers, but a lot more unique ones</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kmers_</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kmers_</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>20055 3062
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We still generate roughly 20000 <code>k-mers</code> but now there are
three times as many unique <code>k-mers</code>. This is one of the factors
that makes assembling a genome so hard.</p>
<p>So now that we have a super simplistic model for generating
<code>k-mers</code>, how do we put them back together?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Assembly">Assembly<a class="anchor-link" href="#Assembly">&#182;</a></h1><p>Left as an exercise for the reader.</p>
<p>Just kidding. Assembly happens by creating
a <a href="https://en.wikipedia.org/wiki/De_Bruijn_graph">de Bruijn graph</a>
from our <code>k-mers</code>. Importantly each <code>k-mer</code> is represented
by an <strong>edge</strong> in the graph, not a node! Nodes are for <code>k-1-mers</code>.
If we have one 4-mer, <code>abcd</code>, the graph would look like this: <code>abc -&gt; bcd</code>.
The first node represents the first <code>n-1</code> symbols in the <code>k-mer</code> and
the second node represents the last <code>n-1</code> symbols.</p>
<p>We will leave the world of biology behind for a moment and create
completely artificial examples. I found this easier to understand
and debug.</p>
<p>First we will need something that can turn a string into a graph.
Using <code>k=2</code> the <code>make_graph</code> function will do just that.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_graph</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">k_mers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kmers</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">kmer</span> <span class="ow">in</span> <span class="n">k_mers</span><span class="p">:</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">kmer</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">kmer</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">nodes</span><span class="p">[</span><span class="n">head</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">nodes</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span><span class="s1">&#39;abcbdexdbfga&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>defaultdict(&lt;class &#39;list&#39;&gt;, {&#39;b&#39;: [&#39;c&#39;, &#39;d&#39;, &#39;f&#39;], &#39;c&#39;: [&#39;b&#39;], &#39;x&#39;: [&#39;d&#39;], &#39;f&#39;: [&#39;g&#39;], &#39;d&#39;: [&#39;e&#39;, &#39;b&#39;], &#39;g&#39;: [&#39;a&#39;], &#39;a&#39;: [&#39;b&#39;], &#39;e&#39;: [&#39;x&#39;]})
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>nodes</code> is a dictionary mapping each node to the list
of outgoing edges for that node. Its printed representation
is quite ugly, so here is a graphical version of it:</p>
<p><img src="/images/euler-graph.png"/></p>
<p>You can render this with <code>graphviz</code> but this is not
installed on tmpbnb.org so will fail here.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">graphviz</span> <span class="kn">import</span> <span class="n">Digraph</span>

<span class="n">dot</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">(</span><span class="n">comment</span><span class="o">=</span><span class="s1">&#39;debruijn&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">km1mer</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
    <span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">km1mer</span><span class="p">,</span> <span class="n">km1mer</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
    <span class="n">ends</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">src</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">ends</span><span class="p">:</span>
        <span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">dot</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>
<span class="n">dot</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>



<div class="output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="290pt" height="260pt"
 viewBox="0.00 0.00 290.00 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>%3</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-256 286,-256 286,4 -4,4"/>
<!-- b -->
<g id="node1" class="node"><title>b</title>
<ellipse fill="none" stroke="black" cx="126" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="126" y="-229.8" font-family="Times,serif" font-size="14.00">b</text>
</g>
<!-- c -->
<g id="node2" class="node"><title>c</title>
<ellipse fill="none" stroke="black" cx="27" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-157.8" font-family="Times,serif" font-size="14.00">c</text>
</g>
<!-- b&#45;&gt;c -->
<g id="edge1" class="edge"><title>b&#45;&gt;c</title>
<path fill="none" stroke="black" d="M105.469,-222.062C89.1648,-211.781 66.6475,-196.129 49.8149,-183.521"/>
<polygon fill="black" stroke="black" points="51.6673,-180.532 41.5937,-177.25 47.4217,-186.098 51.6673,-180.532"/>
</g>
<!-- f -->
<g id="node4" class="node"><title>f</title>
<ellipse fill="none" stroke="black" cx="99" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-157.8" font-family="Times,serif" font-size="14.00">f</text>
</g>
<!-- b&#45;&gt;f -->
<g id="edge3" class="edge"><title>b&#45;&gt;f</title>
<path fill="none" stroke="black" d="M119.601,-216.411C116.486,-208.335 112.666,-198.431 109.165,-189.355"/>
<polygon fill="black" stroke="black" points="112.405,-188.027 105.54,-179.956 105.874,-190.546 112.405,-188.027"/>
</g>
<!-- d -->
<g id="node5" class="node"><title>d</title>
<ellipse fill="none" stroke="black" cx="209" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="209" y="-157.8" font-family="Times,serif" font-size="14.00">d</text>
</g>
<!-- b&#45;&gt;d -->
<g id="edge2" class="edge"><title>b&#45;&gt;d</title>
<path fill="none" stroke="black" d="M138.331,-217.811C149.775,-207.055 166.833,-192.577 181.413,-181.201"/>
<polygon fill="black" stroke="black" points="183.825,-183.764 189.65,-174.914 179.577,-178.2 183.825,-183.764"/>
</g>
<!-- c&#45;&gt;b -->
<g id="edge4" class="edge"><title>c&#45;&gt;b</title>
<path fill="none" stroke="black" d="M47.6972,-174.042C63.8918,-184.265 86.1458,-199.73 102.888,-212.257"/>
<polygon fill="black" stroke="black" points="101.004,-215.221 111.08,-218.496 105.245,-209.652 101.004,-215.221"/>
</g>
<!-- x -->
<g id="node3" class="node"><title>x</title>
<ellipse fill="none" stroke="black" cx="227" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="227" y="-13.8" font-family="Times,serif" font-size="14.00">x</text>
</g>
<!-- x&#45;&gt;d -->
<g id="edge5" class="edge"><title>x&#45;&gt;d</title>
<path fill="none" stroke="black" d="M224.241,-36.1625C222.617,-46.5262 220.578,-60.0061 219,-72 216.278,-92.6811 213.663,-116.128 211.79,-133.763"/>
<polygon fill="black" stroke="black" points="208.287,-133.604 210.725,-143.915 215.249,-134.334 208.287,-133.604"/>
</g>
<!-- g -->
<g id="node6" class="node"><title>g</title>
<ellipse fill="none" stroke="black" cx="99" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-85.8" font-family="Times,serif" font-size="14.00">g</text>
</g>
<!-- f&#45;&gt;g -->
<g id="edge6" class="edge"><title>f&#45;&gt;g</title>
<path fill="none" stroke="black" d="M99,-143.697C99,-135.983 99,-126.712 99,-118.112"/>
<polygon fill="black" stroke="black" points="102.5,-118.104 99,-108.104 95.5001,-118.104 102.5,-118.104"/>
</g>
<!-- d&#45;&gt;b -->
<g id="edge8" class="edge"><title>d&#45;&gt;b</title>
<path fill="none" stroke="black" d="M196.749,-178.114C185.296,-188.885 168.176,-203.418 153.555,-214.824"/>
<polygon fill="black" stroke="black" points="151.123,-212.276 145.297,-221.125 155.37,-217.841 151.123,-212.276"/>
</g>
<!-- e -->
<g id="node8" class="node"><title>e</title>
<ellipse fill="none" stroke="black" cx="255" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="255" y="-85.8" font-family="Times,serif" font-size="14.00">e</text>
</g>
<!-- d&#45;&gt;e -->
<g id="edge7" class="edge"><title>d&#45;&gt;e</title>
<path fill="none" stroke="black" d="M219.438,-145.116C225.202,-136.345 232.484,-125.264 238.955,-115.416"/>
<polygon fill="black" stroke="black" points="242.036,-117.1 244.603,-106.821 236.186,-113.256 242.036,-117.1"/>
</g>
<!-- a -->
<g id="node7" class="node"><title>a</title>
<ellipse fill="none" stroke="black" cx="109" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="109" y="-13.8" font-family="Times,serif" font-size="14.00">a</text>
</g>
<!-- g&#45;&gt;a -->
<g id="edge9" class="edge"><title>g&#45;&gt;a</title>
<path fill="none" stroke="black" d="M101.421,-72.055C102.522,-64.3456 103.853,-55.0269 105.091,-46.3642"/>
<polygon fill="black" stroke="black" points="108.583,-46.6698 106.532,-36.2753 101.653,-45.6798 108.583,-46.6698"/>
</g>
<!-- a&#45;&gt;b -->
<g id="edge10" class="edge"><title>a&#45;&gt;b</title>
<path fill="none" stroke="black" d="M119.238,-34.9825C125.125,-45.1424 131.942,-58.8216 135,-72 145.69,-118.061 138.355,-173.428 132.128,-205.769"/>
<polygon fill="black" stroke="black" points="128.65,-205.311 130.086,-215.808 135.509,-206.706 128.65,-205.311"/>
</g>
<!-- e&#45;&gt;x -->
<g id="edge11" class="edge"><title>e&#45;&gt;x</title>
<path fill="none" stroke="black" d="M248.364,-72.411C245.087,-64.2164 241.056,-54.1395 237.382,-44.9548"/>
<polygon fill="black" stroke="black" points="240.552,-43.4548 233.588,-35.4699 234.052,-46.0546 240.552,-43.4548"/>
</g>
</g>
</svg>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Eulerian-walks">Eulerian walks<a class="anchor-link" href="#Eulerian-walks">&#182;</a></h2><p>Why create this weird graph structure from our reads? At
first it seems like it makes things more complicated. Actually
this is an example of transforming your problem to make it
easier.</p>
<p>To reconstruct the original string from this graph all we
have to do is find a trip along all the edges of the graph
that visits each edge only once. If we can do that, we
are done. People who are into graph theory call this
an eulerian walk. If you grew up in Germany you might
recognise this as solving the <a href="https://de.wikipedia.org/wiki/Haus_vom_Nikolaus">kids puzzle</a> "Das ist das
Haus vom Ni-ko-laus."</p>
<p><a href="https://commons.wikimedia.org/wiki/File:Blender3D_HouseOfStNiclas.gif#/media/File:Blender3D_HouseOfStNiclas.gif"><img src="https://upload.wikimedia.org/wikipedia/commons/1/11/Blender3D_HouseOfStNiclas.gif" alt="Blender3D HouseOfStNiclas.gif"></a><br>Von <a href="//commons.wikimedia.org/wiki/User:SoylentGreen" title="User:SoylentGreen">SoylentGreen</a> - <span class="int-own-work" lang="de">Eigenes Werk</span>, <a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a>, https://commons.wikimedia.org/w/index.php?curid=2308144</p><h2 id="Is-it-a-tour?">Is it a tour?<a class="anchor-link" href="#Is-it-a-tour?">&#182;</a></h2><p>First things first, how will we know if a proposed tour is
a valid one? This is what the next few functions take care
of.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">edges</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List all directed edges of `graph`&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">follow_tour</span><span class="p">(</span><span class="n">tour</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Follow a tour and check it is eulerian&quot;&quot;&quot;</span>
    <span class="n">edges_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tour</span><span class="p">,</span> <span class="n">tour</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edges_</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="c1"># most likely removing an edge that was already used</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
    <span class="c1"># if there are any edges left this is neither</span>
    <span class="c1"># an eulerian tour nor an eulerian trail</span>
    <span class="k">if</span> <span class="n">edges_</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">check_tour</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="n">our_tour</span> <span class="o">=</span> <span class="n">tour</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">valid_tour</span> <span class="o">=</span> <span class="n">follow_tour</span><span class="p">(</span><span class="n">our_tour</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid_tour</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">our_tour</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To construct an actual eulerian cycle or trail we use
<a href="https://en.wikipedia.org/wiki/Eulerian_path#Hierholzer.27s_algorithm">Hierholzer's algorithm</a>.</p>
<p>There are some subtleties we would have to take
care of for a production grade implementation, like
dealing with where to start when the graph only contains
an eulerian path and not a cycle, etc. However it
does the job for small examples and allows you to
witness the miracle of genome assembly!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">tour</span><span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find an eulerian cycle or trail.</span>
<span class="sd">    </span>
<span class="sd">    This does not check if the graph is eulerian</span>
<span class="sd">    so it might return tours that are nonsense.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># _tour() modifies the graph structure so we need to copy it</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_tour</span><span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_tour</span><span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">tour</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_node</span><span class="p">]</span>
    <span class="n">finish_on</span> <span class="o">=</span> <span class="n">end</span> <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start_node</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">tour</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># eulerian trail, not tour?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="p">:</span>
            <span class="k">break</span>
        
        <span class="n">tour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">tour</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">finish_on</span><span class="p">:</span>
            <span class="k">break</span>
    
    <span class="c1"># when we insert a sub-tour we extend the</span>
    <span class="c1"># length of tour, need to track this</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tour</span><span class="p">[:]):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">_tour</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">graph</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">offset</span>
            <span class="n">tour</span> <span class="o">=</span> <span class="n">tour</span><span class="p">[:</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">+</span> <span class="n">tour</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">tour</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>below some examples of graphs I tried out while
writing the algorithm. This is an <a href="http://betatim.github.io/posts/interactive-posts/">interactive blog post</a>
so play around with them. Use the snippet form above to
draw each graph if you prefer to see it visually.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">check_tour</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]})</span>
<span class="n">check_tour</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]})</span>
<span class="n">check_tour</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]})</span>
<span class="n">check_tour</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]})</span>
<span class="n">check_tour</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]})</span>
<span class="n">check_tour</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]})</span>


<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">54</span><span class="p">)</span>
<span class="n">genome</span> <span class="o">=</span> <span class="s1">&#39;abcbdexdbfga&#39;</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">valid</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">check_tour</span><span class="p">(</span><span class="n">genome</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">g</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>defaultdict(&lt;class &#39;list&#39;&gt;, {&#39;b&#39;: [&#39;c&#39;, &#39;d&#39;, &#39;f&#39;], &#39;c&#39;: [&#39;b&#39;], &#39;x&#39;: [&#39;d&#39;], &#39;f&#39;: [&#39;g&#39;], &#39;d&#39;: [&#39;e&#39;, &#39;b&#39;], &#39;g&#39;: [&#39;a&#39;], &#39;a&#39;: [&#39;b&#39;], &#39;e&#39;: [&#39;x&#39;]})
cbfgabdexdbc
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I hope this helps you understand a bit more how all this genome assembly
stuff works. it certainly helped me. If you know about the biology behind
all this, please be lenient, if you spot gross mistakes or imprecise
statements that cause confusion for novices do get in touch!</p>
<p>If you find a mistake or want to tell me something else get in touch on twitter @<a href="//twitter.com/betatim">betatim</a></p>

</div>
</div>
</div>
 



<p>This post started life as a jupyter notebook,
<a href="/downloads/notebooks/genome-assembly.ipynb">download it</a>
or
<a href="http://nbviewer.ipython.org/url/betatim.github.io//downloads/notebooks/genome-assembly.ipynb">view it</a> online.</p>
  </div>
</article>

        </div>
      </div>

<div class="row justify-content-center pb-5">
  <div class="col-md-8">
    <footer>
      <div class="social">
          <a href="https://github.com/betatim"><i class="fa fa-github fa-2x"></i></a>
          <a href="https://twitter.com/betatim"><i class="fa fa-twitter fa-2x"></i></a>
          <a href="mailto:betatim@gmail.com"><i class="fa fa-envelope fa-2x"></i></a>
      </div>
      <div class="powered-by">
        Copyright © 2014-2020  - Tim Head
      </div>
    </footer>
  </div>
</div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  </body>
</html>